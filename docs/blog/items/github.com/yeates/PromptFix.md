# 原始URL: https://github.com/yeates/PromptFix

# 抓取时间: 2025-03-30 21:13:34

[Skip to content](https://github.com/yeates/PromptFix#start-of-content)
## Navigation Menu
Toggle navigation
[ ](https://github.com/)
[ Sign in ](https://github.com/login?return_to=https%3A%2F%2Fgithub.com%2Fyeates%2FPromptFix)
  * Product 
    * [ GitHub Copilot Write better code with AI  ](https://github.com/features/copilot)
    * [ Security Find and fix vulnerabilities  ](https://github.com/features/security)
    * [ Actions Automate any workflow  ](https://github.com/features/actions)
    * [ Codespaces Instant dev environments  ](https://github.com/features/codespaces)
    * [ Issues Plan and track work  ](https://github.com/features/issues)
    * [ Code Review Manage code changes  ](https://github.com/features/code-review)
    * [ Discussions Collaborate outside of code  ](https://github.com/features/discussions)
    * [ Code Search Find more, search less  ](https://github.com/features/code-search)
Explore
    * [ All features ](https://github.com/features)
    * [ Documentation ](https://docs.github.com)
    * [ GitHub Skills ](https://skills.github.com)
    * [ Blog ](https://github.blog)
  * Solutions 
By company size
    * [ Enterprises ](https://github.com/enterprise)
    * [ Small and medium teams ](https://github.com/team)
    * [ Startups ](https://github.com/enterprise/startups)
    * [ Nonprofits ](https://github.com/solutions/industry/nonprofits)
By use case
    * [ DevSecOps ](https://github.com/solutions/use-case/devsecops)
    * [ DevOps ](https://github.com/solutions/use-case/devops)
    * [ CI/CD ](https://github.com/solutions/use-case/ci-cd)
    * [ View all use cases ](https://github.com/solutions/use-case)
By industry
    * [ Healthcare ](https://github.com/solutions/industry/healthcare)
    * [ Financial services ](https://github.com/solutions/industry/financial-services)
    * [ Manufacturing ](https://github.com/solutions/industry/manufacturing)
    * [ Government ](https://github.com/solutions/industry/government)
    * [ View all industries ](https://github.com/solutions/industry)
[ View all solutions ](https://github.com/solutions)
  * Resources 
Topics
    * [ AI ](https://github.com/resources/articles/ai)
    * [ DevOps ](https://github.com/resources/articles/devops)
    * [ Security ](https://github.com/resources/articles/security)
    * [ Software Development ](https://github.com/resources/articles/software-development)
    * [ View all ](https://github.com/resources/articles)
Explore
    * [ Learning Pathways ](https://resources.github.com/learn/pathways)
    * [ Events & Webinars ](https://resources.github.com)
    * [ Ebooks & Whitepapers ](https://github.com/resources/whitepapers)
    * [ Customer Stories ](https://github.com/customer-stories)
    * [ Partners ](https://partner.github.com)
    * [ Executive Insights ](https://github.com/solutions/executive-insights)
  * Open Source 
    * [ GitHub Sponsors Fund open source developers  ](https://github.com/sponsors)
    * [ The ReadME Project GitHub community articles  ](https://github.com/readme)
Repositories
    * [ Topics ](https://github.com/topics)
    * [ Trending ](https://github.com/trending)
    * [ Collections ](https://github.com/collections)
  * Enterprise 
    * [ Enterprise platform AI-powered developer platform  ](https://github.com/enterprise)
Available add-ons
    * [ Advanced Security Enterprise-grade security features  ](https://github.com/enterprise/advanced-security)
    * [ Copilot for business Enterprise-grade AI features  ](https://github.com/features/copilot/copilot-business)
    * [ Premium Support Enterprise-grade 24/7 support  ](https://github.com/premium-support)
  * [Pricing](https://github.com/pricing)


Search or jump to...
# Search code, repositories, users, issues, pull requests...
Search 
Clear
[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)
#  Provide feedback 
We read every piece of feedback, and take your input very seriously.
Include my email address so I can be contacted
Cancel  Submit feedback 
#  Saved searches 
## Use saved searches to filter your results more quickly
Name
Query
To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax). 
Cancel  Create saved search 
[ Sign in ](https://github.com/login?return_to=https%3A%2F%2Fgithub.com%2Fyeates%2FPromptFix)
[ Sign up ](https://github.com/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=yeates%2FPromptFix) Reseting focus
You signed in with another tab or window. [Reload](https://github.com/yeates/PromptFix) to refresh your session. You signed out in another tab or window. [Reload](https://github.com/yeates/PromptFix) to refresh your session. You switched accounts on another tab or window. [Reload](https://github.com/yeates/PromptFix) to refresh your session. Dismiss alert
{{ message }}
[ yeates ](https://github.com/yeates) / **[PromptFix](https://github.com/yeates/PromptFix) ** Public
  * [ Notifications ](https://github.com/login?return_to=%2Fyeates%2FPromptFix) You must be signed in to change notification settings
  * [ Fork 43 ](https://github.com/login?return_to=%2Fyeates%2FPromptFix)
  * [ Star  748 ](https://github.com/login?return_to=%2Fyeates%2FPromptFix)


[NeurIPS 24] PromptFix: You Prompt and We Fix the Photo 
### License
[ Apache-2.0 license ](https://github.com/yeates/PromptFix/blob/main/LICENSE)
[ 748 stars ](https://github.com/yeates/PromptFix/stargazers) [ 43 forks ](https://github.com/yeates/PromptFix/forks) [ Branches ](https://github.com/yeates/PromptFix/branches) [ Tags ](https://github.com/yeates/PromptFix/tags) [ Activity ](https://github.com/yeates/PromptFix/activity)
[ Star  ](https://github.com/login?return_to=%2Fyeates%2FPromptFix)
[ Notifications ](https://github.com/login?return_to=%2Fyeates%2FPromptFix) You must be signed in to change notification settings
  * [ Code ](https://github.com/yeates/PromptFix)
  * [ Issues 3 ](https://github.com/yeates/PromptFix/issues)
  * [ Pull requests 1 ](https://github.com/yeates/PromptFix/pulls)
  * [ Actions ](https://github.com/yeates/PromptFix/actions)
  * [ Projects 0 ](https://github.com/yeates/PromptFix/projects)
  * [ Security ](https://github.com/yeates/PromptFix/security)
  * [ Insights ](https://github.com/yeates/PromptFix/pulse)


Additional navigation options
  * [ Code  ](https://github.com/yeates/PromptFix)
  * [ Issues  ](https://github.com/yeates/PromptFix/issues)
  * [ Pull requests  ](https://github.com/yeates/PromptFix/pulls)
  * [ Actions  ](https://github.com/yeates/PromptFix/actions)
  * [ Projects  ](https://github.com/yeates/PromptFix/projects)
  * [ Security  ](https://github.com/yeates/PromptFix/security)
  * [ Insights  ](https://github.com/yeates/PromptFix/pulse)


# yeates/PromptFix
main
[Branches](https://github.com/yeates/PromptFix/branches)[Tags](https://github.com/yeates/PromptFix/tags)
[](https://github.com/yeates/PromptFix/branches)[](https://github.com/yeates/PromptFix/tags)
Go to file
Code
## Folders and files
Name| Name| Last commit message| Last commit date  
---|---|---|---  
## Latest commit
## History
[17 Commits](https://github.com/yeates/PromptFix/commits/main/)[](https://github.com/yeates/PromptFix/commits/main/)  
[configs](https://github.com/yeates/PromptFix/tree/main/configs "configs")| [configs](https://github.com/yeates/PromptFix/tree/main/configs "configs")  
[dataset](https://github.com/yeates/PromptFix/tree/main/dataset "dataset")| [dataset](https://github.com/yeates/PromptFix/tree/main/dataset "dataset")  
[examples](https://github.com/yeates/PromptFix/tree/main/examples "examples")| [examples](https://github.com/yeates/PromptFix/tree/main/examples "examples")  
[scripts](https://github.com/yeates/PromptFix/tree/main/scripts "scripts")| [scripts](https://github.com/yeates/PromptFix/tree/main/scripts "scripts")  
[stable_diffusion](https://github.com/yeates/PromptFix/tree/main/stable_diffusion "stable_diffusion")| [stable_diffusion](https://github.com/yeates/PromptFix/tree/main/stable_diffusion "stable_diffusion")  
[utils](https://github.com/yeates/PromptFix/tree/main/utils "utils")| [utils](https://github.com/yeates/PromptFix/tree/main/utils "utils")  
[.gitignore](https://github.com/yeates/PromptFix/blob/main/.gitignore ".gitignore")| [.gitignore](https://github.com/yeates/PromptFix/blob/main/.gitignore ".gitignore")  
[LICENSE](https://github.com/yeates/PromptFix/blob/main/LICENSE "LICENSE")| [LICENSE](https://github.com/yeates/PromptFix/blob/main/LICENSE "LICENSE")  
[README.md](https://github.com/yeates/PromptFix/blob/main/README.md "README.md")| [README.md](https://github.com/yeates/PromptFix/blob/main/README.md "README.md")  
[main.py](https://github.com/yeates/PromptFix/blob/main/main.py "main.py")| [main.py](https://github.com/yeates/PromptFix/blob/main/main.py "main.py")  
[process_images_json.py](https://github.com/yeates/PromptFix/blob/main/process_images_json.py "process_images_json.py")| [process_images_json.py](https://github.com/yeates/PromptFix/blob/main/process_images_json.py "process_images_json.py")  
[requirements.txt](https://github.com/yeates/PromptFix/blob/main/requirements.txt "requirements.txt")| [requirements.txt](https://github.com/yeates/PromptFix/blob/main/requirements.txt "requirements.txt")  
View all files  
## Repository files navigation
  * [README](https://github.com/yeates/PromptFix)
  * [Apache-2.0 license](https://github.com/yeates/PromptFix)


[![](https://github.com/yeates/PromptFix/raw/main/examples/logo/promptfix-logo.png)](https://github.com/yeates/PromptFix/blob/main/examples/logo/promptfix-logo.png)
# PromptFix: You Prompt and We Fix the Photo
[](https://github.com/yeates/PromptFix#promptfix-you-prompt-and-we-fix-the-photo)
### NeurIPS 2024
[](https://github.com/yeates/PromptFix#neurips-2024)
[![](https://camo.githubusercontent.com/da13922b2591c0fb45aea5cd9a76bb56ba3b4565d6ea44c9c223e2e117c6ee5e/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f50617065722d61725869762d6233316231622e737667)](https://arxiv.org/pdf/2405.16785) [![](https://camo.githubusercontent.com/978f26af2c4767349b38eebe0809acad824a4244ad020edfa310019180c9ff30/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f576562736974652d50726f6a656374506167652d413535443335)](https://www.yongshengyu.com/PromptFix-Page/) [![](https://camo.githubusercontent.com/394dc6a639f9bc392335550c7909cf69c2bf17a3fb1bf57d47626d56e99c9859/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f5265736f757263652d446174617365742d4546424636412e737667)](https://huggingface.co/datasets/yeates/PromptfixData)
This repository provides the official PyTorch implementation of **PromptFix** , including pre-trained weights, training and inference code, and our curated dataset used for training.
📢 **PromptFix** is designed to follow human instructions to process degraded images and remove unwanted elements. It supports a wide range of tasks, such as:
  * 🎨 **Colorization**
  * 🧹 **Object Removal**
  * 🌫️ **Dehazing**
  * 💨 **Deblurring**
  * 🖼️ **Watermark Removal**
  * ❄️ **Snow Removal**
  * 🌙 **Low-light Enhancement**


Built on a diffusion model backbone, PromptFix delivers outstanding performance in correcting image defects while preserving the original structure, utilizing a 20-step denoising process. It also generalizes effectively across different aspect ratios.
[![](https://github.com/yeates/PromptFix/raw/main/examples/gif/horizontal_scrolling_compressed.gif)](https://github.com/yeates/PromptFix/blob/main/examples/gif/horizontal_scrolling_compressed.gif)
[![](https://github.com/yeates/PromptFix/raw/main/examples/gif/vertical_scrolling_compressed.gif)](https://github.com/yeates/PromptFix/blob/main/examples/gif/vertical_scrolling_compressed.gif)
## Table of Contents
[](https://github.com/yeates/PromptFix#table-of-contents)
  * [Environment Setup](https://github.com/yeates/PromptFix#-environment-setup)
  * [Inference](https://github.com/yeates/PromptFix#-inference)
  * [Download Dataset](https://github.com/yeates/PromptFix#-download-dataset)
    * [Dataset Composition](https://github.com/yeates/PromptFix#-dataset-composition)
  * [🧑‍💻 Training](https://github.com/yeates/PromptFix#-training)
  * [📝 Citing PromptFix](https://github.com/yeates/PromptFix#-citing-promptfix)
  * [🙏 Acknowledgments](https://github.com/yeates/PromptFix#-acknowledgments)
  * [⚠️ Disclaimer](https://github.com/yeates/PromptFix#-disclaimer)


## Environment Setup
[](https://github.com/yeates/PromptFix#environment-setup)
Follow the steps below to clone the repository, set up the environment, and install dependencies. The code is tested on **Python 3.10**.
```
git clone https://github.com/yeates/PromptFix.git
cd PromptFix
conda create -n promptfix python=3.10 -y
conda activate promptfix
pip install -r requirements.txt
```

## Inference
[](https://github.com/yeates/PromptFix#inference)
To process the default image examples, run the following command. The pre-trained model weights will be automatically downloaded from Hugging Face and placed under the `checkpoints/` directory:
```
bash scripts/inference.sh
```

## Download Dataset
[](https://github.com/yeates/PromptFix#download-dataset)
We curated a [training dataset](https://huggingface.co/datasets/yeates/PromptfixData) exceeding **1 million** samples. Each sample includes paired images and instruction and auxiliary text prompts. The dataset covers multiple low-level image processing tasks.
To download the dataset, run the following commands at the project root directory:
```
bash scripts/download_promptfix_dataset.sh
```

### Dataset Composition
[](https://github.com/yeates/PromptFix#dataset-composition)
The dataset includes the following tasks:
Task | Percentage  
---|---  
🎨 **Colorization** | 29.3%  
🌙 **Low-light Enhancement** | 20.7%  
🖼️ **Watermark Removal** | 12.4%  
🧹 **Object Removal** | 11.9%  
❄️ **Snow Removal** | 9.7%  
🌫️ **Dehazing** | 8.9%  
💨 **Deblurring** | 7.1%  
**Total** | **100%**  
**Note:** The dataset is packaged into Parquet files, consisting of 100 parts. Each part can be loaded independently. If you want to experiment with a smaller amount of data without downloading the entire dataset, you can download only a few Parquet files.
## 🧑‍💻 Training
[](https://github.com/yeates/PromptFix#-training)
To train the model, run:
```
bash scripts/train.sh <GPU_NUMS>
```

Replace `<GPU_NUMS>` with the number of GPUs you wish to use.
Once checkpoints are saved, you need to convert the EMA (Exponential Moving Average) format weights into a loadable checkpoint:
```
python scripts/convert_ckpt.py --ema-ckpt <EMA_CKPT_PATH> --out-ckpt <OUT_CKPT_PATH>
```

For example:
```
python scripts/convert_ckpt.py --ema-ckpt ./train_logs/promptfix/checkpoints/ckpt_epoch_0/state.pth --out-ckpt ./checkpoints/promptfix_epoch_1.ckpt
```

## 📝 Citing PromptFix
[](https://github.com/yeates/PromptFix#-citing-promptfix)
If you use our dataset or code, please give the repository a star ⭐ and cite our paper:
```
@inproceedings{yu2024promptfix,
 title={PromptFix: You Prompt and We Fix the Photo},
 author={Yu, Yongsheng and Zeng, Ziyun and Hua, Hang and Fu, Jianlong and Luo, Jiebo},
 booktitle={NeurIPS},
 year={2024}
}
```

## 🙏 Acknowledgments
[](https://github.com/yeates/PromptFix#-acknowledgments)
We would like to thank the authors of [InstructDiffusion](https://github.com/cientgu/InstructDiffusion), [Stable Diffusion](https://github.com/CompVis/stable-diffusion), and [InstructPix2Pix](https://github.com/timothybrooks/instruct-pix2pix) for sharing their codes.
## ⚠️ Disclaimer
[](https://github.com/yeates/PromptFix#️-disclaimer)
This repository is part of an open-source research initiative provided for academic and research purposes only. We have not established any official commercial services, products, or web applications related to this project. Use this software at your own risk; it may not meet all your expectations or requirements.
Please note that the PromptFix dataset is curated from open-source research projects and publicly available photo libraries. By using our dataset, you automatically agree to comply with all applicable licenses and terms of use associated with the source data. Furthermore, you acknowledge and agree that neither the dataset nor any models trained using it may be utilized for any commercial purposes.
## About
[NeurIPS 24] PromptFix: You Prompt and We Fix the Photo 
### Resources
[ Readme ](https://github.com/yeates/PromptFix#readme-ov-file)
### License
[ Apache-2.0 license ](https://github.com/yeates/PromptFix#Apache-2.0-1-ov-file)
[ Activity](https://github.com/yeates/PromptFix/activity)
### Stars
[ **748** stars](https://github.com/yeates/PromptFix/stargazers)
### Watchers
[ **11** watching](https://github.com/yeates/PromptFix/watchers)
### Forks
[ **43** forks](https://github.com/yeates/PromptFix/forks)
[ Report repository ](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fyeates%2FPromptFix&report=yeates+%28user%29)
##  [Releases](https://github.com/yeates/PromptFix/releases)
No releases published
##  [Packages 0](https://github.com/users/yeates/packages?repo_name=PromptFix)
No packages published 
##  [Contributors 3](https://github.com/yeates/PromptFix/graphs/contributors)
## Languages
  * [ Python 99.3% ](https://github.com/yeates/PromptFix/search?l=python)
  * [ Shell 0.7% ](https://github.com/yeates/PromptFix/search?l=shell)


## Footer
[ ](https://github.com "GitHub") © 2025 GitHub, Inc. 
### Footer navigation
  * [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
  * [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
  * [Security](https://github.com/security)
  * [Status](https://www.githubstatus.com/)
  * [Docs](https://docs.github.com/)
  * [Contact](https://support.github.com?tags=dotcom-footer)
  * Manage cookies 
  * Do not share my personal information 


You can’t perform that action at this time. 
